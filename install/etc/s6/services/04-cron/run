#!/usr/bin/with-contenv bash
while [ ! -f /tmp/state/99-container-init ]
do
  sleep 1
done

CRON_CMD=${CRON_CMD:-""}

if [ ! -f /tmp/state/`basename $0` ]; then
  sleep 30
  sed -e "s|<CRON_CMD>|$CRON_CMD|g" -i /assets/cron/crontab.txt
  echo '59 23 * * * logrotate -f /etc/logrotate.d/* >/dev/null 2>&1' >>/assets/cron/crontab.txt
  
  mkdir -p /tmp/state/
  echo 'Initialization Complete' >/tmp/state/`basename $0`
fi

if [ -d /assets/cron/cron-custom ]; then
  echo '[i] Found Custom Crontab - Merging'
  cat /assets/cron/cron-custom/* >>/assets/cron/crontab.txt
fi

echo '[i] Starting cron'
/usr/bin/crontab /sfiles/cron/crontab.txt
exec /usr/sbin/crond -f -l 8 >/dev/null 2>&1;
